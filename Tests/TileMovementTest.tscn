[gd_scene format=4 uid="uid://dptnl2r7a6q1a"]

[ext_resource type="Script" uid="uid://o5n3dduj7g3" path="res://Tests/TileMovementTest.gd" id="1_rgyjq"]
[ext_resource type="Script" uid="uid://2ow1pluircli" path="res://Scripts/Visual/Spin.gd" id="2_gqr1m"]
[ext_resource type="TileSet" uid="uid://bnuthy0vx4048" path="res://Assets/Tiles/Kenney1Bit-Monochrome.tres" id="3_owc60"]
[ext_resource type="PackedScene" uid="uid://dusjndm5o8ehr" path="res://Components/Combat/GunComponent.tscn" id="4_6v6op"]
[ext_resource type="PackedScene" uid="uid://c3u5roi5rwks1" path="res://Templates/Entities/PlayerEntityTemplate-TileBased.tscn" id="4_e6c1b"]
[ext_resource type="Script" uid="uid://ciflnc7p46rqm" path="res://Scripts/Data/TileMapLayerWithCellData.gd" id="4_yp2em"]
[ext_resource type="PackedScene" uid="uid://bifi5b0gcmh1v" path="res://Components/DebugComponent.tscn" id="7_rgyjq"]
[ext_resource type="PackedScene" uid="uid://cw0tix585c5wr" path="res://Templates/Entities/SpriteEntityTemplate.tscn" id="8_0yjwq"]
[ext_resource type="PackedScene" uid="uid://bdmibnkkrpfhv" path="res://Components/Movement/TileBasedPositionComponent.tscn" id="9_foo43"]
[ext_resource type="PackedScene" uid="uid://bhtew2qk3trno" path="res://Components/Movement/TileBasedLinearMotionComponent.tscn" id="10_mhs3o"]
[ext_resource type="PackedScene" uid="uid://cdq0dcwhcrm5p" path="res://Components/Control/InputComponent.tscn" id="11_670k2"]

[node name="TileMovementTest" type="Node2D" unique_id=1638467602]
script = ExtResource("1_rgyjq")

[node name="TileMapA" type="TileMapLayer" parent="." unique_id=1689855843]
unique_name_in_owner = true
modulate = Color(0, 1, 1, 0.5019608)
tile_map_data = PackedByteArray("AAAAAAEAAAAkABEAAAABAAAAAAAkABEAAAACAAAAAAAlABEAAAAAAAIAAAAlABEAAAAAAAMAAAAmABEAAAAAAAQAAAAnABEAAAADAAAAAAAmABEAAAAEAAAAAAAnABEAAAAAAAUAAAAoABEAAAAFAAAAAAAoABEAAAAFAAUAAAApAA0AAAABAAUAAAApAA0AAAACAAUAAAAnAA4AAAADAAUAAAApAA0AAAAEAAUAAAAnAA4AAAAFAAEAAAApAA0AAAAFAAIAAAAnAA4AAAAFAAMAAAApAA0AAAAFAAQAAAAnAA4AAAAEAAQAAAApAA0AAAADAAQAAAAnAA4AAAACAAQAAAApAA0AAAABAAQAAAAnAA4AAAABAAMAAAApAA0AAAACAAMAAAAnAA4AAAADAAMAAAApAA0AAAAEAAMAAAAnAA4AAAACAAIAAAApAA0AAAABAAIAAAAnAA4AAAACAAEAAAAnAA4AAAADAAEAAAApAA0AAAAEAAEAAAAnAA4AAAAEAAIAAAApAA0AAAADAAIAAAAnAA4AAAABAAEAAAApAA0AAAAGAAUAAAAnAA4AAAAGAAAAAAApABEAAAAGAAEAAAAnAA4AAAAGAAIAAAApAA0AAAAGAAMAAAAnAA4AAAAGAAQAAAApAA0AAAAGAAYAAAApAA0AAAAFAAYAAAAnAA4AAAAEAAYAAAApAA0AAAADAAYAAAAnAA4AAAACAAYAAAApAA0AAAABAAYAAAAnAA4AAAAAAAYAAAApABEAAAAAAAAAAAAjABIAAAAAAAkAAAAjABIAAAABAAkAAAAkABEAAAACAAkAAAAlABEAAAADAAkAAAAmABEAAAAEAAkAAAAnABEAAAAFAAkAAAAoABEAAAAGAAkAAAApABEAAAAJAAAAAAAjABIAAAAJAAEAAAAkABEAAAAJAAIAAAAlABEAAAAJAAMAAAAmABEAAAAJAAQAAAAnABEAAAAJAAUAAAAoABEAAAAJAAYAAAApABEAAAAJAAkAAAAjABIAAAABAAcAAAApAA0AAAABAAgAAAAnAA4AAAACAAcAAAAnAA4AAAACAAgAAAApAA0AAAADAAcAAAApAA0AAAADAAgAAAAnAA4AAAAEAAcAAAAnAA4AAAAEAAgAAAApAA0AAAAFAAcAAAApAA0AAAAFAAgAAAAnAA4AAAAGAAcAAAAnAA4AAAAGAAgAAAApAA0AAAAHAAcAAAApAA0AAAAHAAgAAAAnAA4AAAAIAAcAAAAnAA4AAAAIAAgAAAApAA0AAAAAAAcAAAAqABEAAAAAAAgAAAArABEAAAAHAAkAAAAqABEAAAAIAAkAAAArABEAAAAJAAgAAAArABEAAAAHAAAAAAAqABEAAAAHAAEAAAApAA0AAAAHAAIAAAAnAA4AAAAHAAMAAAApAA0AAAAHAAQAAAAnAA4AAAAHAAUAAAApAA0AAAAHAAYAAAAnAA4AAAAIAAAAAAArABEAAAAIAAEAAAAnAA4AAAAIAAIAAAApAA0AAAAIAAMAAAAnAA4AAAAIAAQAAAApAA0AAAAIAAUAAAAnAA4AAAAIAAYAAAApAA0AAAAJAAcAAAAqABEAAAA=")
tile_set = ExtResource("3_owc60")
occlusion_enabled = false
collision_enabled = false
navigation_enabled = false
script = ExtResource("4_yp2em")
metadata/_custom_type_script = "uid://ciflnc7p46rqm"

[node name="TileMapB" type="TileMapLayer" parent="." unique_id=2028673404]
unique_name_in_owner = true
modulate = Color(1, 1, 0, 0.5019608)
position = Vector2(-32, 112)
tile_map_data = PackedByteArray("AAAAAAAAAAAkABIAAAAAAAEAAAANAAEAADABAAAAAAANAAEAAGACAAAAAAANAAEAAFAAAAIAAAANAAEAAAAAAAQAAAAkABIAAAADAAAAAAANAAEAAGAEAAAAAAAkABIAAAACAAQAAAANAAEAAFABAAQAAAANAAEAAFABAAMAAAAkABQAAAACAAMAAAANAAEAAAACAAEAAAANAAEAAAADAAEAAAAkABQAAAAEAAEAAAANAAEAAAABAAEAAAAkABQAAAADAAIAAAANAAEAAFADAAMAAAAkABQAAAADAAQAAAANAAEAAFAEAAIAAAANAAEAAAAEAAMAAAANAAEAADAEAAQAAAAkABIAAAACAAIAAAAQAAEAAAABAAIAAAANAAEAAFAAAAMAAAANAAEAADA=")
tile_set = ExtResource("3_owc60")
occlusion_enabled = false
collision_enabled = false
navigation_enabled = false
script = ExtResource("4_yp2em")
metadata/_custom_type_script = "uid://ciflnc7p46rqm"

[node name="RotatingContainer" type="Node2D" parent="." unique_id=892390430]
texture_filter = 2
position = Vector2(256, 0)
script = ExtResource("2_gqr1m")
speed = 0.1

[node name="TileMapC" type="TileMapLayer" parent="RotatingContainer" unique_id=1441026625]
unique_name_in_owner = true
modulate = Color(1, 1, 1, 0.5019608)
tile_map_data = PackedByteArray("AAAAAAAAAAApABAAAAABAAAAAAAnAA0AAAACAAAAAAAnAA0AAAADAAAAAAAnAA0AAAAEAAAAAAAnAA0AAAAFAAAAAAAnAA0AAAAGAAAAAAAnAA0AAAAHAAAAAAAnAA0AAAAJAAAAAAAnAA0AAAAAAAEAAAAnAA0AAAAAAAIAAAAnAA0AAAAAAAMAAAAnAA0AAAAAAAQAAAAnAA0AAAAAAAUAAAAnAA0AAAAAAAYAAAAnAA0AAAAAAAcAAAAnAA0AAAAAAAgAAAAnAA0AAAAAAAkAAAAnAA0AAAAAAAoAAAAnAA0AAAAAAAsAAAAnAA0AAAAAAAwAAAAnAA0AAAAKAAAAAAAnAA0AAAALAAAAAAAnAA0AAAAMAAAAAAAnAA0AAAANAAAAAAAnAA0AAAAOAAAAAAAVABQAAAAOAAEAAAAnAA0AAAAOAAIAAAAnAA0AAAAOAAMAAAAnAA0AAAAOAAQAAAAnAA0AAAAOAAUAAAAnAA0AAAAOAAYAAAAnAA0AAAAOAAcAAAAnAA0AAAAOAAgAAAAnAA0AAAAOAAkAAAAnAA0AAAAOAAoAAAAnAA0AAAAOAAsAAAAnAA0AAAAOAAwAAAAnAA0AAAAAAA4AAAATABQAAAAOAA4AAAAWABQAAAABAA4AAAAnAA0AAAACAA4AAAAnAA0AAAADAA4AAAAnAA0AAAAEAA4AAAAnAA0AAAAFAA4AAAAnAA0AAAAGAA4AAAAnAA0AAAAHAA4AAAAnAA0AAAAIAA4AAAAnAA0AAAAJAA4AAAAnAA0AAAAKAA4AAAAnAA0AAAALAA4AAAAnAA0AAAAMAA4AAAAnAA0AAAANAA4AAAAnAA0AAAAAAA0AAAAnAA0AAAAIAAAAAAAnAA0AAAAOAA0AAAAnAA0AAAACAAEAAAAuABEAADADAAEAAAAuABEAADAEAAEAAAAuABEAADAFAAEAAAAuABEAADAGAAEAAAAuABEAADAHAAEAAAAuABEAADAIAAEAAAAuABEAADAJAAEAAAAuABEAADAKAAEAAAAuABEAADALAAEAAAAuABEAADAMAAEAAAAuABEAADANAAIAAAAuABEAAGANAAMAAAAuABEAAGANAAQAAAAuABEAAGANAAUAAAAuABEAAGANAAYAAAAuABEAAGANAAcAAAAuABEAAGANAAgAAAAuABEAAGANAAkAAAAuABEAAGANAAoAAAAuABEAAGANAAsAAAAuABEAAGANAAwAAAAuABEAAGAMAA0AAAAuABEAAAALAA0AAAAuABEAAAAKAA0AAAAuABEAAAAJAA0AAAAuABEAAAAIAA0AAAAuABEAAAAHAA0AAAAuABEAAAAGAA0AAAAuABEAAAAFAA0AAAAuABEAAAAEAA0AAAAuABEAAAADAA0AAAAuABEAAAACAA0AAAAuABEAAAABAAwAAAAuABEAAFABAAgAAAAuABEAAFABAAcAAAAuABEAAFABAAYAAAAuABEAAFABAAUAAAAuABEAAFABAAQAAAAuABEAAFABAAMAAAAuABEAAFABAAIAAAAuABEAAFABAAEAAAAlABIAAAANAAEAAAAlABIAAAABAA0AAAAlABIAAAANAA0AAAAlABIAAAADAAMAAAAkABAAAAADAAQAAAAkABAAAAAEAAMAAAAkABAAAAADAAsAAAAkABAAAAAEAAsAAAAkABAAAAALAAMAAAAkABAAAAAKAAMAAAAkABAAAAALAAQAAAAkABAAAAALAAsAAAAkABAAAAALAAoAAAAkABAAAAAKAAsAAAAkABAAAAABAAkAAAAuABEAAFABAAoAAAAuABEAAFABAAsAAAAuABEAAFADAAoAAAAkABAAAAAGAAUAAAAcABQAAAAGAAYAAAAtABEAAAAGAAcAAAAtABEAAAAGAAgAAAAtABEAAAAGAAkAAAAtABEAAAAIAAUAAAAcABQAAAAIAAYAAAAtABEAAAAIAAcAAAAtABEAAAAIAAgAAAAtABEAAAAIAAkAAAAtABEAAAA=")
tile_set = ExtResource("3_owc60")
occlusion_enabled = false
collision_enabled = false
navigation_enabled = false
script = ExtResource("4_yp2em")

[node name="Player-TileBased" parent="." unique_id=671106302 instance=ExtResource("4_e6c1b")]
unique_name_in_owner = true
position = Vector2(8, 8)

[node name="TileBasedControlComponent" parent="Player-TileBased" index="3" unique_id=879116052]
debugMode = true

[node name="TileBasedPositionComponent" parent="Player-TileBased" index="4" unique_id=928173984 node_paths=PackedStringArray("tileMap")]
tileMap = NodePath("../../TileMapA")
debugMode = true

[node name="GunComponent" parent="Player-TileBased" unique_id=949337158 instance=ExtResource("4_6v6op")]

[node name="DebugComponent" parent="Player-TileBased" unique_id=49689741 instance=ExtResource("7_rgyjq")]
modulate = Color(0.5, 1, 0.25, 0.75)
propertiesToLabel = Array[NodePath]([NodePath("../TileBasedPositionComponent:currentCoordinates")])
propertiesToChart = Array[NodePath]([])

[node name="NPC1" parent="." unique_id=1554693337 instance=ExtResource("8_0yjwq")]
modulate = Color(1, 0.5019608, 1, 1)
position = Vector2(112, 48)
region_rect = Rect2(384, 128, 16, 16)

[node name="TileBasedPositionComponent" parent="NPC1" unique_id=1058467208 node_paths=PackedStringArray("tileMap") instance=ExtResource("9_foo43")]
tileMap = NodePath("../../TileMapA")
shouldSnapToInitialDestination = false
speed = 10.0

[node name="MovementIndicator" parent="NPC1/TileBasedPositionComponent" index="0" unique_id=2118168507]
modulate = Color(1, 0.5019608, 1, 1)

[node name="TileBasedLinearMotionComponent" parent="NPC1" unique_id=481816501 instance=ExtResource("10_mhs3o")]
direction = Vector2i(-1, 0)

[node name="Timer" type="Timer" parent="NPC1/TileBasedLinearMotionComponent" unique_id=1311994213]
wait_time = 2.0
autostart = true

[node name="InputComponent" parent="NPC1" unique_id=2056852293 instance=ExtResource("11_670k2")]
isPlayerControlled = false

[node name="NPC2" parent="." unique_id=233225944 instance=ExtResource("8_0yjwq")]
modulate = Color(0.5019608, 1, 0.5019608, 1)
position = Vector2(-8, 168)
region_rect = Rect2(384, 128, 16, 16)

[node name="TileBasedPositionComponent" parent="NPC2" unique_id=1922284284 node_paths=PackedStringArray("tileMap") instance=ExtResource("9_foo43")]
tileMap = NodePath("../../TileMapA")
setInitialCoordinatesFromEntityPosition = false
initialDestinationCoordinates = Vector2i(8, 1)
shouldSnapToInitialDestination = false
speed = 10.0

[node name="MovementIndicator" parent="NPC2/TileBasedPositionComponent" index="0" unique_id=2118168507]
modulate = Color(0.5019608, 1, 0.5019608, 1)

[node name="UI" type="CanvasLayer" parent="." unique_id=699251385]

[node name="HBoxContainer" type="HBoxContainer" parent="UI" unique_id=1157344904]
offset_left = 8.0
offset_top = 8.0
offset_right = 50.0
offset_bottom = 24.0
size_flags_vertical = 0

[node name="ButtonACell" type="Button" parent="UI/HBoxContainer" unique_id=812690162]
layout_mode = 2
size_flags_vertical = 0
text = "A @Cell"

[node name="ButtonBCell" type="Button" parent="UI/HBoxContainer" unique_id=1741256948]
layout_mode = 2
size_flags_vertical = 0
text = "B @Cell"

[node name="ButtonBPixel" type="Button" parent="UI/HBoxContainer" unique_id=804331021]
layout_mode = 2
size_flags_vertical = 0
text = "B @Pixel"

[node name="ButtonCCell" type="Button" parent="UI/HBoxContainer" unique_id=719165239]
layout_mode = 2
size_flags_vertical = 0
text = "C @Cell"

[node name="ButtonCPixel" type="Button" parent="UI/HBoxContainer" unique_id=10811297]
layout_mode = 2
size_flags_vertical = 0
text = "C @Pixel"

[connection signal="timeout" from="NPC1/TileBasedLinearMotionComponent/Timer" to="NPC1/TileBasedLinearMotionComponent" method="move"]
[connection signal="pressed" from="UI/HBoxContainer/ButtonACell" to="." method="onButtonACell_pressed"]
[connection signal="pressed" from="UI/HBoxContainer/ButtonBCell" to="." method="onButtonBCell_pressed"]
[connection signal="pressed" from="UI/HBoxContainer/ButtonBPixel" to="." method="onButtonBPixel_pressed"]
[connection signal="pressed" from="UI/HBoxContainer/ButtonCCell" to="." method="onButtonCCell_pressed"]
[connection signal="pressed" from="UI/HBoxContainer/ButtonCPixel" to="." method="onButtonCPixel_pressed"]

[editable path="Player-TileBased"]
[editable path="Player-TileBased/TileBasedPositionComponent"]
[editable path="NPC1/TileBasedPositionComponent"]
[editable path="NPC2/TileBasedPositionComponent"]
